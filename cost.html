<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Etsy Calculator — 3 Section Layout</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      padding: 20px;
      display: flex;
      justify-content: center;
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      max-width: 900px;
      width: 100%;
      box-shadow: 0 4px 14px rgba(0,0,0,0.12);
    }
    h2 { margin-top: 0; text-align:center; }

    .section-title {
      font-size: 18px;
      font-weight: 700;
      margin: 16px 0;
      padding: 8px;
      background: #eef2ff;
      border-radius: 8px;
      border: 1px solid #dcdcff;
    }

    .grid3 {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
    }

    label { font-size: 14px; font-weight: 600; }
    input {
      width: 100%; padding: 7px; margin-top: 4px;
      font-size: 14px; border-radius: 6px; border: 1px solid #ccc;
    }

    button {
      width: 100%; margin-top: 16px; padding: 12px; font-size: 15px;
      font-weight: 600; background:#4f46e5; color:white;
      border:none; border-radius:8px; cursor:pointer;
    }
    button:hover { background:#4338ca; }

    .result {
      margin-top: 20px; padding: 15px;
      border: 1px dashed #ccc; border-radius: 8px; background:#fafafa;
      font-size: 15px;
    }
  </style>
</head>

<body>
<div class="card">
<h2>Etsy Listing + Buyer Price + Payout Calculator</h2>

<!-- SECTION 1 -->
<div class="section-title">1️⃣ Metal Prices, Weights, Discount, Extra Cost, Fee</div>
<div class="grid3">
  <div><label>Silver Price/g</label><input id="silverPrice" type="number"></div>
  <div><label>10K Gold/g</label><input id="g10Price" type="number"></div>
  <div><label>14K Gold/g</label><input id="g14Price" type="number"></div>

  <div><label>18K Gold/g</label><input id="g18Price" type="number"></div>
  <div><label>Total Grams</label><input id="metalGram" type="number"></div>
  <div><label>Extra Cost</label><input id="extraCost" type="number" value="18000"></div>

  <div><label>Discount %</label><input id="discountRate" type="number" value="20"></div>
  <div><label>Etsy Fee %</label><input id="feeRate" type="number" value="12.3"></div>
</div>

<!-- SECTION 2 -->
<div class="section-title">2️⃣ Listing Price / Target Payout / Buyer Target</div>
<div class="grid3">
  <div><label>Your Listing Price</label><input id="listPrice" type="text"></div>
  <div><label>Target Payout</label><input id="targetPayout" type="text"></div>
  <div><label>Buyer Target Price</label><input id="buyerTarget" type="text"></div>
</div>

<button onclick="calcAll()">Calculate</button>

<!-- SECTION 3 -->
<div class="section-title">3️⃣ Results</div>
<div id="output" class="result" style="display:none;"></div>

</div>

<script>
function fmtINR(n) {
  return '₹ ' + Math.round(n).toLocaleString('en-IN');
}

function handleFormattedInput(e) {
  const input = e.target;
  const oldVal = input.value;
  const cursor = input.selectionStart;

  let digitsBefore = 0;
  for (let i = 0; i < cursor; i++) {
    if (/\d/.test(oldVal[i])) digitsBefore++;
  }

  const numeric = oldVal.replace(/[^\d]/g, '');
  if (!numeric) { input.value = ''; return; }

  const formatted = Number(numeric).toLocaleString('en-IN');
  input.value = formatted;

  let newCursor = 0, count = 0;
  while (newCursor < formatted.length && count < digitsBefore) {
    if (/\d/.test(formatted[newCursor])) count++;
    newCursor++;
  }
  input.setSelectionRange(newCursor, newCursor);
}

function getNum(id) {
  return +((document.getElementById(id).value || '').replace(/,/g,'')) || 0;
}

function calcAll() {
  const sP = getNum('silverPrice');
  const g10 = getNum('g10Price');
  const g14 = getNum('g14Price');
  const g18 = getNum('g18Price');
  const grams = getNum('metalGram');
  const extra = getNum('extraCost');

  const listPrice = getNum('listPrice');
  const target = getNum('targetPayout');
  const buyerTarget = getNum('buyerTarget');

  const feeRate = getNum('feeRate');
  const discRate = getNum('discountRate');

  const discountFactor = (100 - discRate) / 100;
  const feeFactor = 1 - feeRate / 100;
  const netFactor = discountFactor * feeFactor;

  const silverCost = sP * grams + extra;
  const g10Cost = g10 * grams + extra;
  const g14Cost = g14 * grams + extra;
  const g18Cost = g18 * grams + extra;

  let payout=0, buyerPrice=0, fees=0;
  if (listPrice > 0) {
    buyerPrice = listPrice * discountFactor;
    fees = buyerPrice * (feeRate / 100);
    payout = buyerPrice - fees;
  }

  let suggestedList=0, suggestedBuyer=0;
  if (target > 0 && netFactor > 0) {
    suggestedList = target / netFactor;
    suggestedBuyer = suggestedList * discountFactor;
  }

  let listForBuyer=0, payoutForBuyer=0, feesForBuyer=0;
  if (buyerTarget > 0 && discountFactor > 0) {
    listForBuyer = buyerTarget / discountFactor;
    feesForBuyer = buyerTarget * (feeRate / 100);
    payoutForBuyer = buyerTarget - feesForBuyer;
  }

  const out = document.getElementById('output');
  out.style.display = 'block';
  out.innerHTML = `
    <strong>Metal Costing (with +₹${extra.toLocaleString('en-IN')}):</strong><br><br>
    Silver Total: <b>${fmtINR(silverCost)}</b> | +25%: <b>${fmtINR(silverCost * 1.25)}</b><br>
    10K Gold Total: <b>${fmtINR(g10Cost)}</b> | +25%: <b>${fmtINR(g10Cost * 1.25)}</b><br>
    14K Gold Total: <b>${fmtINR(g14Cost)}</b> | +25%: <b>${fmtINR(g14Cost * 1.25)}</b><br>
    18K Gold Total: <b>${fmtINR(g18Cost)}</b> | +25%: <b>${fmtINR(g18Cost * 1.25)}</b><br><br>

    <strong>1️⃣ Listing → Payout</strong><br>
    Listing Price: <b>${fmtINR(listPrice)}</b><br>
    Buyer Price: <b>${fmtINR(buyerPrice)}</b><br>
    Etsy Fees: <b>${fmtINR(fees)}</b><br>
    Payout: <b>${fmtINR(payout)}</b><br><br>

    <strong>2️⃣ Target Payout → Listing</strong><br>
    Target Payout: <b>${fmtINR(target)}</b><br>
    Required Listing: <b>${fmtINR(suggestedList)}</b><br>
    Buyer Sees: <b>${fmtINR(suggestedBuyer)}</b><br><br>

    <strong>3️⃣ Buyer Target → Listing</strong><br>
    Buyer Should See: <b>${fmtINR(buyerTarget)}</b><br>
    Required Listing: <b>${fmtINR(listForBuyer)}</b><br>
    Your Payout: <b>${fmtINR(payoutForBuyer)}</b><br>
  `;
}

window.addEventListener('DOMContentLoaded', () => {
  const ids = [
    'silverPrice','g10Price','g14Price','g18Price','metalGram','extraCost','discountRate','feeRate','listPrice','targetPayout','buyerTarget'
  ];

  ids.forEach((id, i) => {
    const el = document.getElementById(id);
    el.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        if (i === ids.length - 1) calcAll();
        else document.getElementById(ids[i + 1]).focus();
      }
    });
  });

  ['listPrice','targetPayout','buyerTarget']
    .forEach(id => document.getElementById(id).addEventListener('input', handleFormattedInput));
});
</script>

</body>
</html>

