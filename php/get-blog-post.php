<?php
header('Content-Type: application/json');

// Database configuration
$host = 'localhost';
$dbname = 'oceanarcexim';
$username = 'oceanarcuser';
$password = 'strong_password';

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    
    // Get all GET parameters
    $params = $_GET;
    
    // Remove known parameters first
    unset($params['id']);
    
    // Check for slug as a direct parameter (not as key-value pair)
    $slug = null;
    foreach ($params as $key => $value) {
        // If the key is numeric (like in ?value), it's our slug
        if (is_numeric($key)) {
            $slug = $value;
            break;
        }
        // OR if we have a parameter named 'slug'
        if ($key === 'slug') {
            $slug = $value;
            break;
        }
    }
    
    // Check if we have a direct slug parameter (like ?why-global-buyers-choose...)
    if (!$slug && count($params) > 0) {
        // Get the first parameter value that's not 'id'
        $firstParam = reset($params);
        if ($firstParam) {
            $slug = $firstParam;
        }
    }
    
    // Fallback: check for 'slug' parameter
    if (!$slug && isset($_GET['slug'])) {
        $slug = $_GET['slug'];
    }
    
    // Final fallback: check for ID
    if (!$slug && isset($_GET['id'])) {
        $stmt = $pdo->prepare("SELECT * FROM blog_posts WHERE id = ?");
        $stmt->execute([$_GET['id']]);
    } else if ($slug) {
        $stmt = $pdo->prepare("SELECT * FROM blog_posts WHERE slug = ?");
        $stmt->execute([$slug]);
    } else {
        echo json_encode(['error' => 'Post slug or ID is required']);
        exit;
    }
    
    $post = $stmt->fetch(PDO::FETCH_ASSOC);
    
    if ($post) {
        echo json_encode($post);
    } else {
        echo json_encode(['error' => 'Post not found']);
    }
} catch (PDOException $e) {
    echo json_encode(['error' => 'Database error: ' . $e->getMessage()]);
}
?>
